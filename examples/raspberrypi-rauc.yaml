# yaml-language-server: $schema=https://raw.githubusercontent.com/siemens/kas/refs/heads/master/kas/schema-kas.json
header:
  version: 14
  includes:
    - examples/include/common.yaml

local_conf_header:
  raspberrypi: |
    DISTRO_FEATURES:append = " bluez5 bluetooth wifi "
    IMAGE_INSTALL:append = " bluez5 i2c-tools"
    ENABLE_UART = "1"
    LICENSE_FLAGS_ACCEPTED = "synaptics-killswitch"

  rauc-raspberrypi: |
    RPI_USE_U_BOOT = "1"
    IMAGE_INSTALL:append = " rauc"
    DISTRO_FEATURES:append = " rauc"
    IMAGE_INSTALL:append = " kernel-image kernel-modules kernel-devicetree"
    PREFERRED_PROVIDER_virtual/bootloader = "u-boot"
    IMAGE_FSTYPES = " tar.bz2 ext4 wic.bz2 wic.bmap"
    SDIMG_ROOTFS_TYPE = "ext4"
    # Note: Image must be a multiple of 4096 for adaptive updates to work!
    IMAGE_ROOTFS_EXTRA_SPACE:append = " + 409600"
    WKS_FILE = "sdimage-dual-raspberrypi.wks.in"
    # Enable adaptive updates.
    RAUC_SLOT_rootfs[adaptive] = "block-hash-index"
  
  rugix-test:
    IMAGE_INSTALL:append = " rugix-test-file-changed"

machine: raspberrypi-armv8
distro: poky
target:
  - core-image-minimal
  - update-bundle

defaults:
  repos:
    branch: scarthgap

repos:
  poky:
    url: https://github.com/yoctoproject/poky.git
    layers:
      meta:
      meta-poky:
      meta-yocto-bsp:

  meta-raspberrypi:
    url: "https://github.com/agherzan/meta-raspberrypi.git"

  meta-openembedded:
    url: "https://github.com/openembedded/meta-openembedded.git"
    layers:
      meta-oe:
      meta-python:
      meta-networking:
      meta-multimedia:
      meta-filesystems:
  
  meta-rauc:
    url: "https://github.com/rauc/meta-rauc.git"
  
  meta-rauc-community:
    url: "https://github.com/rauc/meta-rauc-community.git"
    layers:
      meta-rauc-raspberrypi:

  meta-rugix:
    path: ../
    layers:
      meta-rugix-test:
